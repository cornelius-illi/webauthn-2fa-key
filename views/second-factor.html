<!--
 * @license
 * Copyright 2021 Google Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>WebAuthn with a security key Codelab</title>
    <meta
      name="description"
      content="Codelab: two-factor authentication with a security key and WebAuthn"
    />
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/css/main.css" />
  </head>
  <body>
    <div class="outer-container">
      <!-- <div id="warningbanner" class="invisible">
        ⚠️ Your browser doesn't support WebAuthn. Open this demo in Chrome, Edge,
        Firefox or Safari.
      </div> //-->
      <header class="header">
        <div class="header-container">
          <div class="logo-container">
            <span class="db-logo db-logo--size-s t:db-logo--size-m db-logo--auto">
              <svg viewBox="0 0 40 28" class="db-logo__db"><rect x="2" y="2" width="36" height="24"></rect><path d="M35.9 0c2.13 0 3.98 1.6 4.1 3.7v20.2a4.12 4.12 0 01-3.9 4.1H4c-2.13 0-3.9-1.7-4-3.9V3.9C0 1.77 1.69.1 3.8 0h32.1zm0 3H4c-.56 0-.95.44-1 .98V23.8c0 .56.35 1.12.88 1.2H35.9c.56 0 1.03-.52 1.1-1.08V4.1c0-.6-.5-1.1-1.1-1.1zM12.2 4.8c4.7 0 7.3 3 7.3 9.1 0 5.3-1.7 9.2-7.3 9.2H5.5V4.8h6.7zm16.9 0c5.2 0 5.3 4.1 5.3 4.5 0 2.4-1.9 3.9-3.2 4.2 3.3.8 3.8 3.2 3.8 4.5 0 4.83-4.75 5.09-6.78 5.1H21.5V4.8zM10.7 7.7h-.8v12.4h1.5c2.4 0 3.7-1.8 3.7-5.9 0-3.6-.4-6.5-4.4-6.5zm17.1 7.7h-2v4.7h1.8c.7 0 3 0 3-2.3 0-1-.6-2.4-2.8-2.4zm-.6-7.8h-1.4V12h1.8c1.5 0 2.4-1 2.4-2.2 0-1.5-.8-2.2-2.8-2.2z"></path></svg>
            </span>
          </div>
          <span>
            <button class="db-button db-button--hover-only db-button--round db-button--size-l" type="button" aria-haspopup="true" aria-controls="menu--1" data-testid="button-toggle-headermenu" id="menu-button--menu" data-reach-menu-button="" title="Hauptmenü">
              <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" class="css-4iwsvz" role="img" aria-hidden="true"><path d="M5 16c0-.531.469-1 1.031-1H17.97c.562 0 1.031.469 1.031 1 0 .563-.469 1-1.031 1H6.03C5.47 17 5 16.562 5 16zm0-4c0-.531.469-1 1.031-1H15c.531 0 1 .469 1 1s-.469 1-1 1H6.031C5.47 13 5 12.531 5 12zm0-4c0-.563.469-1 1.031-1H17.97C18.53 7 19 7.438 19 8c0 .531-.469 1-1.031 1H6.03C5.47 9 5 8.531 5 8z" fill="currentColor" fill-rule="evenodd"></path></svg>
              <span aria-hidden="false">Hauptmenü</span>
            </button>
          </span>
        </div>
      </header>
      <main class="content">
        <div class="spacer-container"></div>
        <div class="illustration-container">
          <svg width="130" height="130" viewBox="0 0 331 331" fill="none" xmlns="http://www.w3.org/2000/svg"><circle r="12.24" transform="matrix(-1 0 0 1 280.902 240.701)" fill="var(--db-secondary-button-pressed-background-color)"></circle><circle r="6.48" transform="matrix(-1 0 0 1 298.182 268.062)" fill="var(--db-secondary-button-pressed-background-color)"></circle><circle r="19.44" transform="matrix(-1 0 0 1 260.742 278.141)" fill="var(--db-secondary-button-pressed-background-color)"></circle><path d="M47.842 149.41c2.529-21.716 12.304-43.059 28.401-64.76 16.177-21.999 38.785-44.167 60.525-43.046 21.74 1.121 42.645 26.02 70.455 45.918 27.999 19.79 62.935 35.068 75.085 60.462 11.963 25.504 1.139 61.124-21.575 80.062-22.606 19.128-57.133 21.085-86.252 26.756-29.119 5.671-52.751 14.757-71.883 8.586-19.21-5.874-33.734-27.113-43.205-48.738-9.66-21.515-14.19-43.714-11.551-65.24Z" fill="var(--db-secondary-button-pressed-background-color)"></path><path d="M112.904 260.849a19.18 19.18 0 0 1-6.244-2.005c-.204.23-.378.485-.518.759a20.065 20.065 0 0 1-.421 1.634c-.008.406.056.811.188 1.196a22.678 22.678 0 0 0 5.561 1.773 3.613 3.613 0 0 0 1.434-3.357ZM96.343 253.997a18.358 18.358 0 0 1 3.286-1.416 18.55 18.55 0 0 1-1.524-2.739 18.835 18.835 0 0 1-.781-1.993 3.742 3.742 0 0 0-2.11.307 3.852 3.852 0 0 0-1.23.88 22.263 22.263 0 0 0 2.358 4.961ZM96.571 239.209c1.324-9.533 9.51-16.606 19.134-16.533 9.624.073 17.702 7.27 18.881 16.821 1.179 9.552-4.906 18.497-14.223 20.909a17.615 17.615 0 0 1 1.553 3.245 21.68 21.68 0 0 0 3.091-1.1c9.81-4.474 15.12-15.23 12.709-25.738-2.411-10.509-11.878-17.873-22.657-17.624-10.779.249-19.896 8.043-21.82 18.652 1.152.349 2.268.807 3.332 1.368Z" fill="var(--db-secondary-button-pressed-background-color)"></path><path d="M100.222 253.395a17.921 17.921 0 0 1-.566-.8 18.362 18.362 0 0 0-3.314 1.403c.313.499.644.982 1.004 1.41a3.879 3.879 0 0 0 1.088-.298c.77-.356 1.4-.96 1.788-1.715ZM95.218 248.149a3.75 3.75 0 0 1 2.11-.307 19.124 19.124 0 0 1-.757-8.633 18.872 18.872 0 0 0-3.358-1.383 22.484 22.484 0 0 0 .775 11.203c.348-.371.766-.67 1.23-.88Z" fill="var(--db-secondary-button-pressed-background-color)"></path><path d="M96.571 239.209a19.122 19.122 0 0 0 .757 8.633 3.871 3.871 0 0 1 2.991 2.204c.327.715.423 1.514.275 2.286a3.567 3.567 0 0 1-.373 1.064 3.8 3.8 0 0 1-1.81 1.755 3.87 3.87 0 0 1-4.423-6.122 22.484 22.484 0 0 1-.775-11.203c-9.775-2.951-20.113 2.468-23.248 12.185-3.135 9.717 2.086 20.155 11.742 23.474 9.656 3.318 20.192-1.706 23.692-11.297.115-.316.22-.628.322-.951.162-.536.304-1.083.421-1.634.06-.31.12-.62.166-.938a18.722 18.722 0 0 0-9.737-19.456Z" fill="var(--db-secondary-background-color)"></path><path fill-rule="evenodd" clip-rule="evenodd" d="m28.362 275.073 43.398-19.815 2.727 5.965 2.721 5.961-11.817 5.393-4.297-1.067-2.02 3.948-4.377-1.231-1.935 4.117-4.42-1.316-2.06 3.84-4.28-1.014-1.88 4.26-4.357-1.186-1.961 4.067-7.226-3.868.011-.038 1.773-8.016Z" fill="var(--db-secondary-background-color)"></path><path d="M96.571 239.209a19.122 19.122 0 0 0 .757 8.633 3.871 3.871 0 0 1 2.991 2.204c.327.715.423 1.514.275 2.286a3.567 3.567 0 0 1-.373 1.064 3.8 3.8 0 0 1-1.81 1.755 3.87 3.87 0 0 1-4.423-6.122 22.484 22.484 0 0 1-.775-11.203c-9.775-2.951-20.113 2.468-23.248 12.185-3.135 9.717 2.086 20.155 11.742 23.474 9.656 3.318 20.192-1.706 23.692-11.297.115-.316.22-.628.322-.951.162-.536.304-1.083.421-1.634.06-.31.12-.62.166-.938a18.722 18.722 0 0 0-9.737-19.456Z" fill="var(--db-secondary-background-color)"></path><path d="m76.236 322.706-.402-4.799 4.636-1.269-.579-4.927 4.477-1.38-.164-4.637 4.766-1.182-.444-4.821 4.691-1.239-.29-4.713 4.531-1.351 3.547-5.022a18.01 18.01 0 0 0 20.938-23.701 18.009 18.009 0 0 0-15.831-11.853c.493 2.252.559 4.576.196 6.853l.348.185a3.6 3.6 0 0 1 1.161-.847 3.623 3.623 0 0 1 4.799 1.79c.158.331.266.683.32 1.046a3.615 3.615 0 0 1-1.435 3.357 3.166 3.166 0 0 1-.639.379 3.622 3.622 0 0 1-4.842-1.759c-.049-.122-.08-.244-.122-.363l-.499-.265a18.762 18.762 0 0 1-17.773 12.324 18.022 18.022 0 0 0 2.013 4.672l-24.846 35.517 2.704 8.319 8.74-.314Z" fill="var(--db-secondary-background-color)"></path><mask id="SVG-illustrations-key-visual_svg-path-14-inside-1_27_224" fill="var(--db-primary-background-color)"><path fill-rule="evenodd" clip-rule="evenodd" d="m213.224 143.005-.05 3.225h3.226l.05-3.225h-3.226Zm66.135 0-.05 3.225h3.226l.05-3.225h-3.226Z"></path></mask><path d="M213.224 143.005v-8.064h-7.939l-.124 7.938 8.063.126Zm-.05 3.225-8.063-.126-.128 8.19h8.191v-8.064Zm3.226 0v8.064h7.939l.124-7.938-8.063-.126Zm.05-3.225 8.063.126.128-8.19h-8.191v8.064Zm62.859 3.225-8.063-.126-.128 8.19h8.191v-8.064Zm.05-3.225v-8.064h-7.939l-.124 7.938 8.063.126Zm3.176 3.225v8.064h7.939l.124-7.938-8.063-.126Zm.05-3.225 8.063.126.128-8.19h-8.191v8.064Zm-77.424-.126-.05 3.225 16.126.252.05-3.225-16.126-.252Zm11.239-4.713h-3.226v16.128h3.226v-16.128Zm-8.013 4.713-.05 3.225 16.126.252.05-3.225-16.126-.252Zm8.063-7.938h-3.226v16.128h3.226v-16.128Zm70.922 11.415.05-3.225-16.126-.252-.05 3.225 16.126.252Zm-4.837-8.19h-3.226v16.128h3.226v-16.128Zm8.063 8.19.05-3.225-16.126-.252-.05 3.225 16.126.252Zm-8.013-11.415h-3.226v16.128h3.226v-16.128Z" fill="var(--db-secondary-button-pressed-background-color)" mask="url(#SVG-illustrations-key-visual_svg-path-14-inside-1_27_224)"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M215.962 198.296c-5.344 0-9.677-4.333-9.677-9.677v-41.932c0-5.345 4.333-9.677 9.678-9.677l64.49.004c5.343 0 9.674 4.33 9.676 9.672l.018 41.929c.002 5.346-4.331 9.681-9.677 9.681h-64.508Z" fill="var(--db-secondary-background-color)"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M244.029 166.773a4.836 4.836 0 0 1 4.233-2.346 4.837 4.837 0 0 1 4.148 2.492 4.839 4.839 0 1 0-8.381-.146Zm-.718 4.021a8.064 8.064 0 1 1 9.676.168l-.057 3.225a4.838 4.838 0 1 1-9.675-.169l.056-3.224Z" fill="var(--db-secondary-button-pressed-background-color)"></path><path fill="var(--db-secondary-text-color)" d="M85.102 173.189h41.472v18.72H85.102z"></path><g filter="url(#SVG-illustrations-key-visual_svg-filter0_d_27_224)"><rect x="70.846" y="190.037" width="69.984" height="4.32" rx="2.16" fill="var(--db-secondary-background-color)"></rect></g><rect x="20.302" y="59.141" width="172.368" height="115.344" rx="6.48" fill="var(--db-secondary-background-color)"></rect><mask id="SVG-illustrations-key-visual_svg-mask0_27_224" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="20" y="59" width="173" height="116"><rect x="20.302" y="59.141" width="172.368" height="115.344" rx="6.48" fill="var(--db-primary-background-color)"></rect></mask><g mask="url(#SVG-illustrations-key-visual_svg-mask0_27_224)"><path fill="var(--db-secondary-button-pressed-background-color)" d="M16.414 56.549h178.848v99.792H16.414z"></path><rect x="26.782" y="65.621" width="159.408" height="84.24" rx="1.296" fill="var(--db-secondary-background-color)"></rect></g><rect x="106.894" y="77.686" width="115.632" height="217.008" rx="17.424" fill="var(--db-secondary-text-color)"></rect><path fill-rule="evenodd" clip-rule="evenodd" d="M136.99 82.438h-11.088c-7.873 0-14.256 6.383-14.256 14.256v178.992c0 7.873 6.383 14.256 14.256 14.256h77.616c7.874 0 14.256-6.383 14.256-14.256V96.694c0-7.873-6.382-14.256-14.256-14.256H192.43v1.584a4.752 4.752 0 0 1-4.752 4.752h-45.936a4.752 4.752 0 0 1-4.752-4.752v-1.584Z" fill="var(--db-primary-background-color)"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M166.42 150.47c10.749 4.01 25.883 9.685 32.017 12.038-.609 30.801-10.309 49.252-32.017 60.902-21.708-11.65-31.408-30.101-32.017-60.902 6.134-2.353 21.268-8.028 32.017-12.038m0 79.41a4.23 4.23 0 0 0 1.9-.451c25.254-12.615 36.52-33.669 36.52-68.252 0-3.092 0-3.092-19.85-10.533l-17.084-6.377a4.269 4.269 0 0 0-2.972 0l-17.084 6.377C128 158.085 128 158.085 128 161.177c0 34.583 11.266 55.637 36.52 68.252a4.23 4.23 0 0 0 1.9.451Z" fill="var(--db-pulse-background)"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M174.189 184.276c5.253 0 9.181 4.223 9.181 10.17v7.991c0 3.822-13.899 14.968-16.84 14.968-2.942 0-17.06-11.265-17.06-14.968v-7.991c0-5.902 3.884-10.215 9.137-10.17.309.003.53.046.75.182a13.428 13.428 0 0 0 7.063 1.998c2.516 0 4.9-.681 7.062-1.998.221-.136.442-.182.707-.182ZM166.42 162.21c5.473 0 9.887 4.586 9.887 10.17s-4.414 10.17-9.887 10.17c-5.473 0-9.888-4.586-9.888-10.17s4.415-10.17 9.888-10.17Z" fill="var(--db-pulse-background)"></path><defs><filter id="SVG-illustrations-key-visual_svg-filter0_d_27_224" x="68.846" y="190.037" width="71.984" height="6.32" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix><feOffset dx="-1" dy="1"></feOffset><feGaussianBlur stdDeviation="0.5"></feGaussianBlur><feColorMatrix values="0 0 0 0 0.686275 0 0 0 0 0.705882 0 0 0 0 0.733333 0 0 0 1 0"></feColorMatrix><feBlend in2="BackgroundImageFix" result="effect1_dropShadow_27_224"></feBlend><feBlend in="SourceGraphic" in2="effect1_dropShadow_27_224" result="shape"></feBlend></filter></defs></svg>
        </div>
        <div class="spacer-container"></div>
        <div class="db-pulse db-logo--size-m db-pulse--auto" style="text-align: center">
          <h1><span class="db-headline db-fs8 t:db-fs8 d:db-fs8">🔑 Two-factor<br/>Authentication</span></h1>
        </div>
        <div class="spacer-container"></div>
          <div class="form-container">
            <div>
              <span class="db-body db-fs5 t:db-fs5 d:db-fs5 db-body--secondary">
                When you're ready to authenticate, push the button below. You're seeing
                this screen because you've set up two-factor authentication for your
                account.
              </span>
            </div>
            <div class="spacer-container"></div>
            <div class="button-container">
              <button class="db-button db-button--primary db-button--default db-button--size-l" id="authenticateButton">
                Use security key
              </button>
            </div>
          </div>
        </form>
        <script type="module">
          import { authenticateTwoFactor, authStatuses } from "/auth.client.js";
    
          const button = document.querySelector("#authenticateButton");
          button.addEventListener("click", async e => {
            try {
              // Ask the user to authenticate with the second factor; this will trigger a browser prompt
              const response = await authenticateTwoFactor();
              const { authStatus } = response;
              if (authStatus === authStatuses.COMPLETE) {
                // The user is properly authenticated => Navigate to the Account page
                location.href = "/account";
              } else {
                throw new Error("Two-factor authentication failed");
              }
            } catch (e) {
              // Alert the user that something went wrong
              alert(`Two-factor authentication failed. ${e}`);
            }
          });
        </script>
      </main>
    </div>
  </body>
</html>
